- job-template:
    name: 'devstudio.versionwatch_{devstudio-stream}'
    disabled: '{obj:disabled}'
    description: |
                 Bundle version control for JBDS<br/>
                 Maintainers: jpeterka, nboldt<br/>
                 Latest reports: <a href=ws/sources>ws/sources</a>*.html<br/>
    logrotate:
      daysToKeep: "{default-daysToKeep}"
      numToKeep: "{default-numToKeep}"
      artifactDaysToKeep: "{default-artifactDaysToKeep}"
      artifactNumToKeep: "{default-artifactNumToKeep}"
    properties:          
      - github:
          url: https://github.com/jbosstools/jbosstools-versionwatch/
      - raw: 
          xml: |
            <com.chikli.hudson.plugin.naginator.NaginatorOptOutProperty><optOut>false</optOut></com.chikli.hudson.plugin.naginator.NaginatorOptOutProperty>
      - inject:
          enabled: true
    parameters:
      - string:
          name: EXCLUDE_IUS
          default: ""
          description: "regex match of IUs to exclude, such as org.eclipse.wst.server_ui.feature"
      - string:
          name: INCLUDE_IUS
          default: ".*(jboss|hibernate).*"
          description: "regex match of IUs to include, such as jboss & hibernate"
    scm:
      - git:
          url: git@github.com:jbosstools/jbosstools-versionwatch.git
          branches: 
            - '{default-remote}/{branch}'
          browser: githubweb
          browser-url: https://github.com/jbosstools/jbosstools-versionwatch/
          basedir: "sources"
    node: "{default-nodes}"
    jdk: '{default-jdk}'

    builders:
      - shell: |
               . ${{WORKSPACE}}/sources/run.jenkins.job.sh -INCLUDE_VERSIONS "(8|9)\.\d+\.\d+" -INCLUDE_IUS "${{INCLUDE_IUS}}" -EXCLUDE_IUS "${{EXCLUDE_IUS}}" -JAVA_HOME "${{NATIVE_TOOLS}}${{SEP}}${{JAVA18}}" -DTRACE=true
    publishers:
      - archive:
          artifacts: "**/target/*.zip, **/target/**/*.zip, **/*.log, **/coverage-report/**, **/jacoco.exec, **/sources/*.html"
          excludes: ".repository, .repository/*, .repository/**"
          latest-only: false
          allow-empty: true
          only-if-success: false
          fingerprint: false
          default-excludes: true
      - description-setter: 
          regexp: "BUILD_DESCRIPTION='(.+)'"
          regexp-for-failed: ".*(no installation folders found|Incorrect version format).*"
          description: "\\1"
          description-for-failed: "\\1"
      - text-finder:
          regexp: ".*(^ERROR |FAILURE IN OUTPUT: ).*"
          unstable-if-found: true
          also-check-console-output: true
    wrappers:
        - timeout:
            timeout: 20
            timeout-var: 'build_timeout'
            type: absolute
            abort: true
            write-description: "Build timed out & aborted after ${{build_timeout}} minutes."
        - timestamps:
        - xvnc:
            screenshot: false
            xauthority: true
